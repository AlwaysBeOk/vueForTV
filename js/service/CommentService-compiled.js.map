{"version":3,"sources":["CommentService.js"],"names":[],"mappings":"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","file":"CommentService-compiled.js","sourcesContent":["import $ from 'jquery'\r\nexport class CommentService {\r\n  /**\r\n   *ImgTextService 评论的接口服务,查看例子<a href='../es6/service/imgtext/eg/index.html'> ImgTextService的使用</a>\r\n   * @requires jquery\r\n   * @param zid {String} zid 评论的ID\r\n   * @param ps {int} ps 评论每页条数\r\n   */\r\n  constructor(zid, ps) {\r\n    this.zid = zid;\r\n    this.ps = 20;\r\n    this.pn = 1;\r\n    this.repn = 1;\r\n    this.actionUrl = \"http://newcomment.cntv.cn/comment/upload\";\r\n    if (ps) {\r\n      this.ps = ps;\r\n    }\r\n    this.url = `http://common.newcomment.cntv.cn/comment/list?app=cctvnews&itemid=${zid}&prepage=${this.ps}`;\r\n  };\r\n\r\n  /**\r\n   * 根据页码获取评论数据\r\n   * @param callback {Function} 回调函数\r\n   * @param pn {int} 页码 不传值是1\r\n   */\r\n  get(callback, pn) {\r\n    this.pn = pn || 1;\r\n    $.ajax({\r\n      dataType: 'jsonp',\r\n      jsonp: 'jsonp_callback',\r\n      url: this.url,\r\n      data: {'page': pn},\r\n      success: function (data) {\r\n        callback(data);\r\n      }\r\n    });\r\n  };\r\n\r\n  /**\r\n   * 获取第一页数据\r\n   * @param callback {Function} 回调函数\r\n   */\r\n  init(callback) {\r\n    this.pn = 1;\r\n    get(callback, 1);\r\n  };\r\n\r\n  /**\r\n   * 获取下一页数据\r\n   * @param callback {Function} 回调函数\r\n   */\r\n  next(callback) {\r\n    this.pn = this.pn + 1;\r\n    this.get(callback, this.pn++)\r\n  };\r\n\r\n  /**\r\n   * 循环获取首页数据\r\n   * @param callback {Function} 回调函数\r\n   * @param _interTime {int} 间隔时间(毫秒数)默认是10秒\r\n   */\r\n  interval(callback, _interTime) {\r\n    _interTime = _interTime || 10000;\r\n    var that = this;\r\n    setInterval(function () {\r\n      $.ajax({\r\n        dataType: 'jsonp',\r\n        jsonp: 'jsonp_callback',\r\n        url: that.url,\r\n        data: {'page': 1},\r\n        success: function (data) {\r\n          callback(data);\r\n        }\r\n      });\r\n    }, _interTime)\r\n  };\r\n\r\n  submitComment(_content, _mark, head, _pic) {\r\n    var data = encodeURIComponent($.base64.encode('uid=12211121&time=' + new Date().getTime() / 1000));\r\n    var zid = this.zid;\r\n    if (_content || _pic) {\r\n      if (!_mark) {\r\n        _mark = \"央视网友\"\r\n      }\r\n      $.post('http://newcomment.cntv.cn/comment/post', {\r\n        app: \"cctvnews\",\r\n        itemid: zid,\r\n        message: _content,\r\n        mark: head,\r\n        pic: _pic,\r\n        authorid: '122111',\r\n        author: _mark,\r\n        data: data\r\n      });\r\n    }\r\n  };\r\n\r\n  replyComment(_replyId, _content) {\r\n    var data = encodeURIComponent($.base64.encode('uid=12211121&time=' + new Date().getTime() / 1000));\r\n    var zid = this.zid;\r\n    if (_content) {\r\n      $.post('http://newcomment.cntv.cn/comment/post', {\r\n        app: \"cctvnews\",\r\n        itemid: zid,\r\n        message: _content,\r\n        replyid: _replyId,\r\n        tid: _replyId,\r\n        authorid: '122111',\r\n        author: '',\r\n        data: data\r\n      });\r\n    }\r\n  };\r\n\r\n  agree(_replyId) {\r\n    var data = encodeURIComponent($.base64.encode('uid=12211121&time=' + new Date().getTime() / 1000));\r\n    var zid = this.zid;\r\n    if (_replyId) {\r\n      $.ajax({\r\n        dataType: 'jsonp',\r\n        jsonp: 'jsonp_callback',\r\n        url: 'http://newcomment.cntv.cn/comment/agree',\r\n        data: {\r\n          app: \"cctvnews\",\r\n          itemid: zid,\r\n          tid: _replyId,\r\n          pid: _replyId,\r\n          data: data\r\n        },\r\n        success: function (data) {\r\n          console.info(data);\r\n        }\r\n      });\r\n\r\n    }\r\n\r\n  };\r\n\r\n  pageReply(_replyId, _callback) {\r\n    var _itemId = this.zid;\r\n    if (_replyId) {\r\n      $.ajax({\r\n        dataType: 'jsonp',\r\n        jsonp: 'jsonp_callback',\r\n        url: 'http://common.newcomment.cntv.cn/comment/list',\r\n        data: {\r\n          app: \"cctvnews\",\r\n          itemid: _itemId,\r\n          replyid: _replyId,\r\n          prepage: 100\r\n        },\r\n        success: function (data) {\r\n          _callback(data);\r\n        }\r\n      });\r\n\r\n    }\r\n\r\n  };\r\n\r\n  uploadImg(formId, _callback) {\r\n    $(formId).ajaxSubmit({\r\n\r\n      type: \"POST\",//提交类型\r\n      dataType: \"json\",//返回结果格式\r\n      url: this.actionUrl,//请求地址\r\n      data: {\"action\": this.actionUrl, 'app': 'cctvnews', 'itemid': 'attachments'},//请求数据\r\n      success: function (data) {//请求成功后的函数\r\n        console.log(data);\r\n        _callback(data);\r\n      },\r\n      error: function (data) {\r\n        console.log(data);\r\n      },//请求失败的函数\r\n      async: true\r\n\r\n    });\r\n  };\r\n\r\n  initReplyComment(_callback) {\r\n    var commentApp = 'cctvnews',\t\t\t\t//应用\r\n      commentItemid = this.zid,\t\t//文章id\r\n      commentItemtype = 0,\t\t\t\t//图文\r\n      commentPage = 1,\t\t\t\t\t//页码\r\n      commentPrepage = 20;\t\t\t\t//默认条数\r\n    var crul = 'http://common.newcomment.cntv.cn/reply/special?app=cctvnews&itemid=' + commentItemid + '&itemtype=0&prepage=' + commentPrepage + '&page=' + commentPage;\r\n    $.ajax({\r\n      dataType: 'jsonp',\r\n      jsonp: 'jsonp_callback',\r\n      url: crul,\r\n      success: function (data) {\r\n        _callback(data);\r\n      }\r\n    });\r\n  };\r\n\r\n  getReplyComment(_pn, _callback) {\r\n    this.repn = _pn;\r\n    var commentApp = 'news',\t\t\t\t//应用\r\n      commentItemid = this.zid,\t\t//文章id\r\n      commentItemtype = 0,\t\t\t\t//图文\r\n      commentPage = _pn,\t\t\t\t\t//页码\r\n      commentPrepage = 20;\t\t\t\t//默认条数\r\n    var crul = 'http://common.newcomment.cntv.cn/reply/special?app=cctvnews&itemid=' + commentItemid + '&itemtype=0&prepage=' + commentPrepage + '&page=' + commentPage;\r\n    $.ajax({\r\n      dataType: 'jsonp',\r\n      jsonp: 'jsonp_callback',\r\n      url: crul,\r\n      success: function (data) {\r\n        _callback(data);\r\n      }\r\n    });\r\n  };\r\n\r\n  nextReply(callback) {\r\n    this.repn = this.repn + 1;\r\n    this.getReplyComment(this.repn++, callback);\r\n  };\r\n\r\n\r\n  intervalReplyComment(_interTime, _callback) {\r\n    var commentApp = 'cctvnews',\t\t\t\t//应用\r\n      commentItemid = this.zid,\t\t//文章id\r\n      commentItemtype = 0,\t\t\t\t//图文\r\n      commentPage = 1,\t\t\t\t\t//页码\r\n      commentPrepage = 20;\t\t\t\t//默认条数\r\n    var crul = 'http://common.newcomment.cntv.cn/reply/special?app=cctvnews&itemid=' + commentItemid + '&itemtype=0&jsonp_callback=JSON_CALLBACK&prepage=' + commentPrepage + '&page=' + commentPage;\r\n\r\n    $interval(function () {\r\n      $.ajax({\r\n        dataType: 'jsonp',\r\n        jsonp: 'jsonp_callback',\r\n        url: crul,\r\n        success: function (data) {\r\n          _callback(data);\r\n        }\r\n      });\r\n    }, _interTime)\r\n  };\r\n}\r\n"]}